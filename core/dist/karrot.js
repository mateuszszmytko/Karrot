!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r(r.s=8)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.getControllerId=function(){return e._currentControllerId++,"k_"+e._currentControllerId},e.getControllerMeta=function(e){e.prototype&&e.prototype.constructor||(e=Object.getPrototypeOf(e).constructor);for(var t={},r=0,n=Reflect.getMetadataKeys(e);r<n.length;r++){var o=n[r];if(0===o.indexOf("Controller:")){var i=o.replace("Controller:",""),a=Reflect.getMetadata(o,e);t[i]=a}}return t},e._currentControllerId=0,e._conntrollers=[],e}();t.ControllerUtils=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(11);t.Controller=n.Controller;var o=r(13);t.ControllersFactory=o.ControllersFactory;var i=r(5);t.ControllersResolver=i.ControllersResolver;var a=r(6);t.ControllersStorage=a.ControllersStorage;var l=r(4);t.Settings=l.Settings},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.parent=e,this._depedencies=[],this._depedenciesCapsules=[]}return Object.defineProperty(e.prototype,"depedencies",{get:function(){var e=this._depedencies;return this.parent&&(e=e.concat(this.parent.depedencies)),e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depedenciesCapsules",{get:function(){var e=this._depedenciesCapsules;return this.parent&&(e=e.concat(this.parent.depedenciesCapsules)),e},enumerable:!0,configurable:!0}),e.prototype.addTransient=function(e){this.add(e,"transient")},e.prototype.addSingleton=function(e,t){this.add(e,"singleton",t)},e.prototype.add=function(e,t,r){void 0===t&&(t="singleton"),r&&(this._depedencies.push(r),Reflect.defineMetadata("Injector:constructor",e,r),Reflect.defineMetadata("Injector:type",t,r)),this._depedenciesCapsules.push({depedencyCon:e,type:t})},e.prototype.getDepedency=function(e){return this.depedencies.find(function(t){for(var r=Reflect.getMetadata("Injector:constructor",t)||t.constructor,n=e;Object.getPrototypeOf(n);){if(n===r)return!0;n=Object.getPrototypeOf(n)}return r===e})},e.prototype.getDepedencys=function(e){return this.depedencies.filter(function(t){return t.constructor===e})},e.prototype.resolve=function(e){var t=this,r=(Reflect.getMetadata("design:paramtypes",e)||[]).map(function(e){return t.getOrCreateDepedency(e)});return this.createInstance(e,r)},e.prototype.resolveMethod=function(e,t){var r=this,n=(Reflect.getMetadata("design:paramtypes",e,t)||[]).map(function(e){return r.getOrCreateDepedency(e)});e[t].apply(e,n)},e.prototype.createChildInjector=function(){return new e(this)},e.prototype.getOrCreateDepedency=function(e){var t=this;if(e){var r=this.getDepedency(e);if(!r||"transient"===Reflect.getMetadata("Injector:type",r)){var n=this.depedenciesCapsules.find(function(t){return t.depedencyCon===e});if(!n)return;var o=(Reflect.getMetadata("design:paramtypes",e)||[]).map(function(e){return e?t.getOrCreateDepedency(e):void 0});r=this.createInstance(e,o),this._depedencies.push(r),Reflect.defineMetadata("Injector:constructor",e,r),Reflect.defineMetadata("Injector:type",n.type,r)}return r}},e.prototype.createInstance=function(e,t){for(var r=new(e.bind.apply(e,[void 0].concat(t))),n=0,o=t;n<o.length;n++){var i=o[n];i&&("function"==typeof i.onInject&&i.onInject(r))}return r},e}();t.Injector=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.toCamelCase=function(e){return e.replace(/([\-|\_|\s]\w)/g,function(e){return e[1].toUpperCase()})}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){this.targetElement=e,this.settings=new Map;var r=Reflect.getMetadata("Controller:settings",t);for(var n in r)if(r.hasOwnProperty(n)){var o=r[n];this.settings.set(n,o)}var i=e.dataset;for(var n in i){if(n&&i.hasOwnProperty(n))if(o=i[n]){if(o.indexOf(";")>0&&!this.settings.get("skipArrayParsing")){for(var a=o.replace(/\;+\s+/g,";").split(";"),l=o,c=!1,s=0,u=a;s<u.length;s++){if((d=u[s]).indexOf(":")>0){c=!0;break}}l=c?"{":"[";for(var f=0,p=a;f<p.length;f++){var d;if(""!==(d=p[f]))if(c){var y=d.replace(/\:+\s+/g,":").split(":");l+='"'+y[0]+'": ';try{JSON.parse(y[1]||y[0]),l+=y[1]+","}catch(e){l+='"'+(y[1]||y[0])+'",'}}else try{JSON.parse(d),l+=d+","}catch(e){l+='"'+d+'",'}}l=l.substr(0,l.length-1),o=l+=c?"}":"]"}try{var h=o.replace(/\'/g,'"');if(!h)throw new Error;o=JSON.parse(h)}catch(e){}this.settings.set(n,o)}}}return e.defineStatic=function(e,t){var r=Reflect.getMetadata("Controller:settings",e);for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];r[n]=o}Reflect.defineMetadata("Controller:settings",r,e)},e.prototype.get=function(e){return this.settings.get(e)},e.prototype.set=function(e,t,r){if(void 0===r&&(r=!1),"function"!=typeof t&&r)try{var n="object"==typeof t?JSON.stringify(t):t.toString();this.targetElement.dataset[e]=n}catch(e){}return this.settings.set(e,t),t},e}();t.Settings=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._controllersStorage=e.controllersStorage,this._controllersFactory=e.controllersFactory,this._itemsParser=e.itemsParser}return e.prototype.onInit=function(){this.createControllers(),this.initializeControllers()},e.prototype.createControllers=function(){for(var e=0,t=this._controllersStorage.controllersConstructors;e<t.length;e++)for(var r=t[e],n=0,o=this._controllersFactory.create(r);n<o.length;n++){var i=o[n];this._controllersStorage.controllers.push(i)}},e.prototype.initializeControllers=function(){for(var e=0,t=this._controllersStorage.controllers;e<t.length;e++){t[e].__karrotConstructor()}for(var r=0,n=this._controllersStorage.controllers;r<n.length;r++){n[r].__karrotParse(this._itemsParser)}for(var o=0,i=this._controllersStorage.controllers;o<i.length;o++){i[o].__karrotInit()}},e}();t.ControllersResolver=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._controllersConstructors=e,this._controllers=[]}return Object.defineProperty(e.prototype,"controllers",{get:function(){return this._controllers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"controllersConstructors",{get:function(){return this._controllersConstructors},enumerable:!0,configurable:!0}),e}();t.ControllersStorage=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(15);t.Hooks=n.Hooks},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0});var o=r(9);t.Karrot=o.Karrot;var i=r(16);t.Injectable=i.Injectable,n(r(17)),n(r(1)),n(r(7))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(10);t.Karrot=function(e){new n.KarrotImp(e).onInit()}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(1),o=r(5),i=r(6),a=r(14),l=r(7),c=r(2),s=function(){function e(e){this.args=e,this._rootInjector=new c.Injector;var t=new i.ControllersStorage(e.controllers),r=new n.ControllersFactory(this._rootInjector),s=new a.ItemsParser(t);this._rootInjector.addSingleton(i.ControllersStorage,t),this._rootInjector.addTransient(l.Hooks),this._controllersResolver=new o.ControllersResolver({controllersFactory:r,controllersStorage:t,itemsParser:s})}return e.prototype.onInit=function(){if(this.args.depedencies)for(var e=0,t=this.args.depedencies;e<t.length;e++){var r=t[e];this._rootInjector.add(r,"singleton")}this._controllersResolver.onInit()},e}();t.KarrotImp=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(12),o=r(0);t.Controller=function(e){return function(t){Reflect.defineMetadata("Controller:name",e.name,t),e.selector&&Reflect.defineMetadata("Controller:selector",e.selector,t),Reflect.defineMetadata("Controller:depedencies",e.depedencies,t),Reflect.defineMetadata("Controller:settings",e.settings||[],t),e.paramTypes&&Reflect.defineMetadata("design:paramtypes",e.paramTypes,t),t.prototype.__karrotConstructor=function(){this._controllerId=o.ControllerUtils.getControllerId(),this._controllerElement.setAttribute(this._controllerId,""),this._lifecycle=new n.ControllerLifecycle(this)},t.prototype.__karrotParse=function(e){this._lifecycle.execute("kBeforeParse"),e.parse(this),this._lifecycle.execute("kAfterParse")},t.prototype.__karrotInit=function(){this._lifecycle.execute("kBeforeInit"),this._lifecycle.execute("kOnInit")}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._controller=e}return e.prototype.execute=function(e){"function"==typeof this._controller[e]&&this._controller[e]()},e}();t.ControllerLifecycle=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(2),o=r(0),i=r(3),a=r(4),l=function(){function e(e){this._injector=e,this._controllersConstructors=[]}return e.prototype.create=function(e){var t=[],r=o.ControllerUtils.getControllerMeta(e);if(r.name)for(var n=i.toCamelCase(r.name),a=0,l=Array.from(document.querySelectorAll("[k-name]"));a<l.length;a++)for(var c=0,s=(y=l[a]).getAttribute("k-name").replace(/\s+/g,"").split(";");c<s.length;c++){var u=s[c];if(i.toCamelCase(u)===n)(d=this.createController(e,y))&&(d._controllerElement=y,t.push(d))}if(r.selector)for(var f=0,p=Array.from(document.querySelectorAll(r.selector));f<p.length;f++){var d,y=p[f];(d=this.createController(e,y))&&(d._controllerElement=y,t.push(d))}return t},e.prototype.createController=function(e,t){if(e){var r=o.ControllerUtils.getControllerMeta(e),i=new a.Settings(t,e),l=new n.Injector(this._injector);if(l.addSingleton(HTMLElement,t),l.addSingleton(a.Settings,i),r.depedencies)for(var c=0,s=r.depedencies;c<s.length;c++){var u=s[c];l.addSingleton(u)}return l.resolve(e)}},e}();t.ControllersFactory=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),o=r(3),i=function(){function e(e){this.controllersStorage=e}return e.prototype.parse=function(e){var t=n.ControllerUtils.getControllerMeta(e).items;if(t)for(var r=0,o=t;r<o.length;r++){var i=o[r],a=this.getItemObject(i,e);a&&this.appendItem(i,e,a)}},e.prototype.getItemObject=function(e,t){e.capsule.type&&Reflect.defineMetadata("design:type",e.capsule.type,t,e.propertyKey);var r=Reflect.getMetadata("design:type",t,e.propertyKey)||HTMLElement,o=this.getElementsByName(e,t);if(r&&o){for(var i=r;Object.getPrototypeOf(i);){if(i===HTMLElement)return o[0];i=Object.getPrototypeOf(i)}if(r===Array){var a=this.controllersStorage.controllers.filter(function(e){return n.ControllerUtils.getControllerMeta(e).name===name});return 0===a.length?o:a}for(var l=[],c=function(e){l.push.apply(l,s.controllersStorage.controllers.filter(function(t){return t._controllerElement===e}))},s=this,u=0,f=o;u<f.length;u++){c(f[u])}for(var p=0,d=l;p<d.length;p++){var y=d[p];if(y instanceof r)return y}}},e.prototype.appendItem=function(e,t,r){t[e.propertyKey]=r},e.prototype.getElementsByName=function(e,t){var r=[];switch(e.capsule.searchStrategy){case"all":r=Array.from(document.querySelectorAll("[k-name]"));break;case"children":r=Array.from(t._controllerElement.querySelectorAll("[k-name]"));break;case"parents":r=Array.from(document.querySelectorAll("[k-name]"));var n=Array.from(t._controllerElement.querySelectorAll("[k-name]"));r=r.filter(function(e){return-1===n.indexOf(e)});break;case"siblings":var i=t._controllerElement.parentElement;if(!i)break;r=Array.from(i.children).filter(function(e){return e!==t._controllerElement&&e.matches("[k-name]")})}for(var a=[],l=o.toCamelCase(e.name),c=0,s=r;c<s.length;c++)for(var u=s[c],f=0,p=u.getAttribute("k-name").replace(/\s+/g,"").split(";");f<p.length;f++){var d=p[f];o.toCamelCase(d)===l&&a.push(u)}return a},e}();t.ItemsParser=i},function(e,t,r){"use strict";var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function l(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){e.done?o(e.value):new r(function(t){t(e.value)}).then(a,l)}c((n=n.apply(e,t||[])).next())})},o=this&&this.__generator||function(e,t){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){this.actions=[],this.filters=[]}return e.prototype.addAction=function(e,t,r){void 0===r&&(r=100),this.actions.push({name:e,method:t,index:r})},e.prototype.doAction=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return n(this,void 0,void 0,function(){var r,n,i,a,l;return o(this,function(o){switch(o.label){case 0:if(0===(r=this.actions.filter(function(t){return t.name===e}).sort(function(e,t){return e.index-t.index})).length)return[2];n=0,i=r,o.label=1;case 1:return n<i.length?(a=i[n],(l=a.method.apply(a,t))instanceof Promise?[4,l]:[3,3]):[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}})})},e.prototype.addFilter=function(e,t,r){void 0===r&&(r=100),this.filters.push({name:e,method:t,index:r})},e.prototype.applyFilter=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n(this,void 0,void 0,function(){var n,i,a,l,c;return o(this,function(o){switch(o.label){case 0:n=this.filters.filter(function(e){return e.name===t}).sort(function(e,t){return e.index-t.index}),i=0,a=n,o.label=1;case 1:return i<a.length?(l=a[i],(c=l.method.apply(l,[e].concat(r)))instanceof Promise?[4,c]:[3,3]):[3,5];case 2:return e=o.sent(),[3,4];case 3:e=c,o.label=4;case 4:return i++,[3,1];case 5:return[2,e]}})})},e.prototype.applyFilterSync=function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n(this,void 0,void 0,function(){var n,i,a,l,c;return o(this,function(o){for(n=this.filters.filter(function(e){return e.name===t}).sort(function(e,t){return e.index-t.index}),i=0,a=n;i<a.length;i++)l=a[i],(c=l.method.apply(l,[e].concat(r)))instanceof Promise||(e=c);return[2,e]})})},e}();t.Hooks=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Injectable=function(){return function(e){}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(18);t.Item=n.Item;var o=r(19);t.Inject=o.Inject},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Item=function(e,t){return void 0===t&&(t={searchStrategy:"children"}),function(r,n){var o=Reflect.getMetadata("Controller:items",r.constructor)||[],i=e||n;"string"==typeof t?t={searchStrategy:t}:t.searchStrategy||(t.searchStrategy="children"),o.push({propertyKey:n,name:i,capsule:t}),Reflect.defineMetadata("Controller:items",o,r.constructor)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Inject=function(e){return function(t,r){Reflect.defineMetadata("design:type",e,t,r)}}}]);
//# sourceMappingURL=karrot.js.map